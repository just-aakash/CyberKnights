<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register Student</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header with Back Button -->
  <header>
    <button class="back-btn" onclick="window.location.href='home.html'">Back to Home</button>
  </header>

  <h2>Register New Student</h2>

  <!-- Camera Section -->
  <div class="camera-container">
    <video id="camera" autoplay></video>
    <div class="controls">
      <button onclick="capture()">Capture Photo</button>
      <button onclick="registerStudent()">Register</button>
      <button onclick="closeCamera()">Close Camera</button>
    </div>
  </div>

  <!-- Registration Form -->
  <form id="studentForm">
    <input type="text" id="rollno" placeholder="Roll No" required>
    <input type="text" id="name" placeholder="Name" required>
  </form>

  <!-- Captured Images -->
  <div id="photos"></div>

  <!-- Registered Students -->
  <h3>Registered Students</h3>
  <div id="output"></div>

  <script>
    let video = document.getElementById('camera');
    let photosDiv = document.getElementById('photos');
    let output = document.getElementById('output');
    let capturedImages = [];

    // Open camera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => alert("Camera access denied: " + err));

    // Capture photo
    function capture() {
      if (capturedImages.length >= 2) {
        alert("You can only capture 2 photos!");
        return;
      }
      let canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      let ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      let img = document.createElement('img');
      img.src = canvas.toDataURL("image/png");
      photosDiv.appendChild(img);
      capturedImages.push(img.src);
    }

    // Register student
    function registerStudent() {
      let roll = document.getElementById('rollno').value;
      let name = document.getElementById('name').value;

      if (!roll || !name || capturedImages.length < 2) {
        alert("Please fill details and capture 2 photos!");
        return;
      }

      let studentDiv = document.createElement('div');
      studentDiv.className = "student";
      studentDiv.innerHTML = `
        <p><b>Roll No:</b> ${roll}</p>
        <p><b>Name:</b> ${name}</p>
        <div>
          <img src="${capturedImages[0]}">
          <img src="${capturedImages[1]}">
        </div>
      `;
      output.appendChild(studentDiv);

      // Reset form & photos
      document.getElementById('studentForm').reset();
      photosDiv.innerHTML = "";
      capturedImages = [];
    }

    // Close camera
    function closeCamera() {
      let stream = video.srcObject;
      if (stream) {
        let tracks = stream.getTracks();
        tracks.forEach(track => track.stop());
      }
      video.srcObject = null;
    }
  </script>
</body>
</html>
